From b81f2019f23b131bbe143b275a9eee16352b9738 Mon Sep 17 00:00:00 2001
From: Emilio Pozuelo Monfort <pochu27@gmail.com>
Date: Wed, 27 Mar 2013 16:12:05 +0100
Subject: [PATCH 2/3] cursor: set an error if we can't create a monitor

Otherwise we crash in impl_activate()

https://bugzilla.gnome.org/show_bug.cgi?id=696707
---
 plugins/cursor/gsd-cursor-manager.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/plugins/cursor/gsd-cursor-manager.c b/plugins/cursor/gsd-cursor-manager.c
index abfcc0f..ddc6dc6 100644
--- a/plugins/cursor/gsd-cursor-manager.c
+++ b/plugins/cursor/gsd-cursor-manager.c
@@ -177,8 +177,12 @@ add_device (GdkDeviceManager *device_manager,
 
         /* Create IdleMonitors for each pointer device */
         monitor = gnome_idle_monitor_new_for_device (device);
-        if (!monitor)
+        if (!monitor) {
+                g_set_error (error, GSD_CURSOR_MANAGER_ERROR,
+                             GSD_CURSOR_MANAGER_ERROR_FAILED,
+                             "Per-device idletime monitor not available");
                 return FALSE;
+        }
         g_hash_table_insert (manager->priv->monitors,
                              device,
                              monitor);
-- 
1.7.10.4

